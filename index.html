<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Notation – Debug</title>
</head>
<body style="font-family:system-ui;padding:18px">
  <h2>Notation – Debug</h2>

  <button id="btnLogin">Se connecter Microsoft 365</button>
  <button id="btnLoad">Charger apprentis</button>

  <pre id="log" style="margin-top:12px;background:#111;color:#0f0;padding:12px;border-radius:10px;white-space:pre-wrap"></pre>

  <script defer src="https://alcdn.msauth.net/browser/2.35.0/js/msal-browser.min.js"></script>
  <script>
    const log = (m) => document.getElementById("log").textContent += m + "\n";
    window.addEventListener("error", (e) => log("ERREUR JS: " + e.message));

    // Mets TES valeurs ici
    const TENANT_ID = "TON_TENANT_ID";
    const CLIENT_ID = "TON_CLIENT_ID";

    const SCOPES = ["User.Read","Files.ReadWrite"];

    const msalConfig = {
      auth: {
        clientId: CLIENT_ID,
        authority: `https://login.microsoftonline.com/${TENANT_ID}`,
        redirectUri: window.location.origin + window.location.pathname
      },
      cache: { cacheLocation: "localStorage" }
    };

    let msalInstance;

    async function initAuth(){
      msalInstance = new msal.PublicClientApplication(msalConfig);
      await msalInstance.initialize();
      const resp = await msalInstance.handleRedirectPromise();
      if (resp?.account) msalInstance.setActiveAccount(resp.account);

      const acc = msalInstance.getAllAccounts();
      if (!msalInstance.getActiveAccount() && acc.length) msalInstance.setActiveAccount(acc[0]);

      log("Auth initialisée. Connecté = " + !!msalInstance.getActiveAccount());
    }

    function login(){
      return msalInstance.loginRedirect({ scopes: SCOPES });
    }

    document.getElementById("btnLogin").onclick = login;
    document.getElementById("btnLoad").onclick = () => log("Ici on branchera loadApprentis()");

    initAuth().catch(e => log("Init KO: " + (e.message || e)));
  </script>
</body>
</html>
